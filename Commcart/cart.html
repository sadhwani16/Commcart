<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Commcart</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/js/all.min.js" crossorigin="anonymous"></script>
    <style>
        .checked { color: orange; }
        /* Style for each cart item */
        .cart-item { display: flex; align-items: center; margin-bottom: 20px; border-bottom: 1px solid #ccc; padding-bottom: 20px; }
        .cart-item img { max-width: 80px; max-height: 80px; margin-right: 20px; }
        .cart-item h3 { margin-bottom: 5px; font-size: 16px; }
        .cart-item p { margin: 0; font-size: 14px; color: black; }
        .cart-item button { padding: 5px 10px; background-color: #ff6347; color: white; border: none; border-radius: 5px; cursor: pointer; transition: background-color 0.3s ease; }
        .cart-item button:hover { background-color: #d0523e; }
        #total-price { margin-top: 20px; font-size: 18px; font-weight: bold; }
        #empty-cart-message { display: none; margin-top: 20px; font-size: 16px; text-align: center; }
        #empty-cart-message button { padding: 10px 20px; background-color: #ff6347; color: white; border: none; border-radius: 5px; cursor: pointer; transition: background-color 0.3s ease; margin-bottom: 50px; }
        #empty-cart-message button:hover { background-color: #d0523e; }
    </style>
</head>

<body>
    <section id="header">
        <a href="index.html">
            <h2 style="color: #ff5f5f; text-decoration: none;">Commcart</h3>
        </a>
        <div>
            <ul id="navbar">
                <li><a href="index.html">Home</a></li>
                <li><a href="shop.html">Shop</a></li>
                <li><a href="about.html">About</a></li>
                <li><a href="contact.html">Contact</a></li>
                <li id="lg-bag"><a class="active" href="cart.html"><i class="fa fa-shopping-cart"></i></a></li>
                <a href="#" id="close"><i class="fa far fa-times"></i></a>
            </ul>
        </div>
        <div id="mobile">
            <a href="cart.html"><i class="fa fa-shopping-cart"></i></a>
            <i id="bar" class=" fa fas fa-outdent"></i>
        </div>
    </section>

    <section id="page-header" class="about-header">
        <h2>Shopping Cart</h2>
        <h3 style="color: white;">Discover the heart of Commcart - where convenience meets style, making every click count.</h3>
    </section>

    <section id="cart-items">
        <!-- Cart items will be dynamically added here -->
    </section>

    <div id="total-price"></div>

    <div class="product">
        <img src="images/products/7.jpeg" alt="Product 1">
        <h3>Instibuzz</h3>
        <p>399</p>
        <button onclick="addToCart(this)">Add to Cart</button>
    </div>
    <div class="product">
        <img src="images/products/5.png" alt="Product 2">
        <h3>IITea</h3>
        <p>399</p>
        <button onclick="addToCart(this)">Add to Cart</button>
    </div>

    <div id="empty-cart-message">
        <button onclick="window.location.href='shop.html'">Continue Shopping</button>
    </div>

    <footer class="section-p1" style="border-top:0.5px solid grey;">
        <div class="col">
            <img class="logo" src="images/logo/logo.jpeg" style="height: 100px;width: 100px;">
            <h4>Contact</h4>
            <p><strong>Address:</strong>Indian Institue Of Technology Madras ,Chennai 600036 </p>
            <p><strong>Phone:</strong>+91 9826591325</p>
            <p><strong>Hours:</strong>24*7 Hrs Mon -Sun</p>
            <div class="follow">
                <h4>Follow us</h4>
                <div class="icon">
                    <i class=" fa fa-facebook"></i>
                    <i class="fa fa-twitter"></i>
                    <i class="fa fa-instagram"></i>
                    <i class="fa fa-pinterest"></i>
                    <i class="fa fa-youtube"></i>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Function to add the product to the cart and save it to the backend
        function addToCart(button) {
            var productContainer = button.closest('.product');
            var productImage = productContainer.querySelector('img').src;
            var productName = productContainer.querySelector('h3').innerText;
            var productPrice = productContainer.querySelector('p').innerText.replace('$', '');

            var product = {
                name: productName,
                price: productPrice,
                image: productImage
            };

            // Send the product data to the backend
            fetch('/api/cart/add', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(product)
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                alert(`${product.name} has been added to your cart!`);
            })
            .catch(error => {
                console.error('Error adding product to cart:', error);
            });
        }

        // Function to display the cart items
        document.addEventListener("DOMContentLoaded", function () {
            displayCartItems();
        });

        function displayCartItems() {
            fetch('/api/cart/items')
            .then(response => response.json())
            .then(cartItems => {
                let cartItemsHTML = "";
                let totalPrice = 0;
                cartItems.forEach(item => {
                    cartItemsHTML += `
                        <div class="cart-item">
                            <img src="${item.image}" alt="${item.name}">
                            <div>
                                <h3>${item.name}</h3>
                                <p>$${item.price}</p>
                                <button class="remove-button" data-name="${item.name}" onclick="removeCartItem(this)">Remove</button>
                            </div>
                        </div>
                    `;
                    totalPrice += parseFloat(item.price);
                });

                document.getElementById("cart-items").innerHTML = cartItemsHTML;
                document.getElementById("total-price").innerText = "Total Price: $" + totalPrice.toFixed(2);

                // Show empty cart message if cart is empty
                document.getElementById("empty-cart-message").style.display = cartItems.length === 0 ? "block" : "none";
            })
            .catch(error => console.error('Error fetching cart items:', error));
        }

        function removeCartItem(button) {
            var itemName = button.getAttribute("data-name");
            fetch(`/api/cart/remove`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name: itemName })
            })
            .then(() => {
                button.parentElement.parentElement.remove();
                displayCartItems();
            })
            .catch(error => console.error('Error removing item:', error));
        }
    </script>
</body>
</html>
